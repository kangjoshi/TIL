# 단위테스트

## 단위테스트 코드 작성 순서
_효율적인 작성 순서 AAA + A (필요시)_
1. 준비 (**A**rrange)  
테스트 코드 실행전 준비 단계 (객체생성 등)
2. 실행 (**A**ct)  
테스트 코드 실행
3. 단언 (**A**ssert)  
기대한 결과 값이 출력되었는지 확인
4. 사후 (**+A**fter)  
해제해야할 자원이 있다면 정리

## FIRST
_효과적인 단위 테스트를 작성하는 기본 전술_  

**F**ast : 빠른  
단위테스트의 가치는 지속적이고 종합적인 빠른 피드백에 있다. 느리게 하는 원인(의존성 등)을 찾아 개선하자.  

**I**solated : 고립된  
테스트 코드와 상호 작용하는 코드가 많아질수록 테스트가 실패할 가능성(로직에 대한 실패가 아닌 외부 변수에 의한)이 늘어난다. 검증하려는 작은 양의 코드에 집중하여 작성하자.  

**R**epeatable : 반복 가능한  
반복 가능한 테스트는 항상 동일한 결과가 나오도록 작성되야 한다. 통제할 수 없는 외부 요인은 테스트 코드를 신뢰할 수 없게 하므로 목 객체를 사용하여 외부 요인을 제어하여 기대한 결과가 일관되도록 하자.  

**S**elf-validating : 스스로 검증 가능한  
코드에 기대하는 결과를 단언(Assert)해야 한다. 결과를 수동으로 검증하는 것은 많은 시간 소요와 중요한 문제를 놓칠수 있는 리스크가 발생할 수 있다.  

**T**imely : 적시의  
가능하면 적절한 순간에 단위 테스트에 집중하자. 큰 결함이 없고 변경될 가능성이 없는 레거시 코드에 대한 단위 테스트 작성보다는 좀 더 적절한 부분에 수행하는것이 바람직하다.  

## Right-BICEP
_무엇을 테스트할지 선별하는 전술_  

**Right** : 올바른 결과인가?  
테스트 코드가 기대한 결과를 산출하는지 검증할 수 있어야한다.  
작성자는 주어진 입력(요구 사항의 변경 등 불완전 할 경우 현재에 주어진 조건에서 최선의 판단을 하고 추후 명확 해지면 개선하면 된다.)에 대해 올바른 출력을 예상할 수 있을때(로직에 대한 이해) 테스트 코드를 작성해야 한다.  

**B**oundary-condition : 경계 조건은 맞는가?  
많은 결함은 모서리 사례(경계 조건)에 의해 발생한다. 테스트로(예외처리, 보호된 값 return) 이를 처리 해야한다.  
- 발생 가능한 경계 조건
  - 유효하지 않은 인자(null, "" 등)
  - 수치적 오버플로를 일으키는 계산
  - 중복을 허용해서는 안되는 목록에 중복 값이 있는 경우
- CORRECT (고려해야할 경계조건 판단 전략)
  - **C**onformance : 값이 기대한 양식을 준수하는가? (정상적인 이메일 양식, 전화번호 양식 등)  
  - **O**rdering : 적절하게 정렬되거나 정렬되지 않았나?  
  - **R**ange : 이성적인 최소값과 최대값 안에 있는가?  
  - **R**eference : 통제할 수 없는 외부 참조를 포함하고 있는가?  
  - **E**xistence : 값이 존재하는가?  
  - **C**ardinality : 충분한 값들이 있는가?  
  - **T**ime : 모든것이 순서대로 일어나는가? 

**I**nverse-relationship : 역 관계를 검사할 수 있는가?  
때때로 논리적인 역 관계(덧셈 -> 뺄셈, 곱셈 -> 나눗셈)를 적용하여 행동을 검사할 수 있다. 긍정 사례 답변과 역 사례 답변으로 교차 검사하여 모든 요소를 균형이 맞는지 확인할 수 있다.

**C**ross-check : 다른 수단을 활용하여 교차 검사할 수 있는가?  
예를 들어 대출된 도서의 수에 대한 테스트는 대출된 총 도서의 수 검사 후 잔여 도서 수를 더하여 총 도서 수를 검사하는 것(대출 도서 수 + 잔여 도서 수 = 총 도서 수)과 같이 서로 교차 검사를 할 수 있다.

**E**rror-conditions : 오류 조건을 강제로 일어나게 할 수 있는가?  
오류를 강제로 발생시켜 최악의 상황이 발생하였을 경우에도 우아하고 이성적인 방식으로 작동하는 코드를 작성 해야한다.  
- 대표적인 오류 시나리오
  - 유효하지 않은 인자
  - 메모리, 디스크가 가득 찰 때
  - 네트워크 가용성 및 오류들

**P**erformance-characteristics : 성능 조건은 기준에 부합하는가?  
성능 문제가 발생할 경우 추측만으로 대응하기 보다는 단위 테스트를 설계하여 진짜 문제가 어디에 있으며 예상한 변경 사항으로 어떤 차이가 생겼는지 파악해야 한다. 경과 시간을 측정하는 성능 테스트를 작성하고 여러번 실행하여 평균을 계산하여 개선 해나간다.


---
### Reference
제프랭어외2인. _자바와 JUnit을 활용한 실용주의 단위 테스트_. 길벗