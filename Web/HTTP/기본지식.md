## HTTP (HyperText Transfer Protocol)

HyperText 메시지를 교환하려고 고안 되었으나 지금은 Image, 음성에서 부터 JSON 까지 거의 모든 형태의 데이터 전송

##### 기반 프로토콜

TCP : HTTP/1.1, HTTP/2

UDP : HTTP/3



### HTTP 특징

##### 클라이언트 서버 구조

Request - Response 구조, 클라이언트는 서버에 요청을 보내고 서버로 부터 응답을 받는다.

##### 상태를 가지지 않는다. (Stateless)

서버가 클라이트의 상태를 보존하지 않는다. 클라이언트는 서버에 요청시 필요한 정보를 넘겨서 원하는 상태로 동작하도록 한다.

##### 비 연결성

HTTP는 기본이 연결을 유지하지 않는다. 동시 접속자가 많아도 실제 동시에 처리하는 요청은 많지 않다.

연결을 유지하지 않음으로 서버의 자원을 효율적으로 사용할 수 있다.

HTTP의 비 연결성은 매 연결마다 3-WAY-Handshake를 해야하기 때문에 요청이 많다면 연결 시간이 추가된다. 이는 HTTP 지속 연결로 문제 해결할 수 있다. (HTTP/2, HTTP/3은 이 부분이 더 최적화 되었다.)

##### HTTP 메시지

요청 메시지, 응답 메시지로 구분

Start-line : 시작 라인 - header : 헤더 - empty line : 공백라인 - message body : 본문 구조를 가지고 있다.



### HTTP 메서드

##### GET

리소스 조회

서버에 전달할 데이터는 query를 통해서 전달, 메시지 바디를 사용하여 전달할 수 있지만, 지원하지 않는 서버가 있으므로 권장하지 않음.

##### POST

요청 데이터 처리

메시지 바디를 통해 서버로 요청 데이터 전달

##### PUT

리소스가 있다면 대체, 없다면 생성한다.

리소스 전체를 변경한다.

##### PATCH

리소스 부분을 변경한다.

지원을 하지 않는 서버도 있을 수 있다.

##### DELETE

리소스를 제거한다.

### HTTP 메서드의 속성

##### 안전 (GET)

호출해도 리소스를 변경하지 않는다.

##### 멱등 (GET, PUT, DELETE)

항상 동일한 결과를 반환한다. (외부 요인에 따른 리소스 변경까지는 고려 되지 않음.)

클라이언트가 같은 요청을 중복 해서 해도 되는지 판단하는 근거가 된다.

##### 캐시가능 (GET, POST, PATCH)

응답 결과를 캐시해서 사용해도 되는지

실무에서는 GET만 캐시로 사용, POST, PATCH는 메시지 바디 내용까지 캐시 키로 고려해야 하는데 구현이 쉽지 않다.

### HTTP 상태 코드

##### 1xx : 요청이 수신되어 처리 중

##### 2xx : 정상 처리

- 200 OK : 요청 성공
- 201 Created : 요청이 성공해서 새로운 리소스가 생성 됨. (생성된 리소스는 응답의 Location 헤더 필드로 넣어서 식별)
- 202 Accepted : 요청이 접수되었으나 처리는 완료되지 않았음. (배치 처리와 같은 곳에서 사용)
- 204 No Content : 요청을 성공적으로 수행했지만, 응답 페이로드 본문에 보낼 데이터는 없음.

##### 3xx : 요청을 완료하려면 유저 에이전트의 추가 행동이 필요

- 웹 브라우저는 3xx 응답 결과에 Location 헤더가 있으면 Location 위치로 자동 리다이렉트
- 301 Moved Permanently : 리소스의 URI가 영구적으로 이동, 검색 엔진에서도 변경 인지, 리다이렉트시 요청 메서드가 GET으로 변하고 본문은 사라질 수 있음.
- 308 Permanent Redirect : 리소스의 URI가 영구적으로 이동, 검색 엔진에서도 변경 인지, 리다이렉트시 요청 메서드의 메서드와 본문 유지
- 302 Found : 리소스의 URI이 일시적으로 변경, 리다이렉트시 요청 메서드가 GET으로 변하고 본문이 제거될 수 있음.
- 303 See Other : 리소스의 URI이 일시적으로 변경, 리다이렉트시 요청 메서드가 무조건 GET으로 변함 (302은 브라우저에 따라서 GET으로 변하지 않을 수 있음.)
- 307 Temporary Redirect : 리소스의 URI이 일시적으로 변경,  리다이렉트시 요청 메서드의 메서드와 분문 유지
- 304 Not Modified : 캐시를 목적으로 사용, 클라이언트에게 리소스가 수정되지 않았으므로 로컬 캐시를 재사용하라고 알려준다.

PRG : Post / Redirect / Get

POST로 주문후에 웹 브라우저를 새로고침하면? 중복 주문이 발생할 수 있음.

이를 방지하기 위해 POST 주문 후(200 또는 201이 아닌 302 + Location /order-result/1과 같이 응답을 내려 줌)에 주문 결과 화면으로 GET 메서드로 리다이렉트

##### 4xx : 클라이언트 오류

- 4xx 오류는 클라이언트가 이미 잘못된 요청을 하므로 똑같은 요청을 해도 실패할 것
- 400 Bad Request : 클라이언트가 잘못된 요청을 해서 서버가 요청을 처리할 수 없음. (요청 파라미터가 잘못되었거나 API 스펙이 맞지 않음.)
- 401 Unauthorized : 인증 되지 않음. WWW-Authenticate 헤더와 함께 인증 방법 설명을 보내야한다.
- 403 Forbidden : 서버가 요청을 이해했지만 승인을 거부함. 인증은 되었지만 인가가 되지 않은 경우
- 404 Not Found : 요청 리소스를 찾을 수 없음.

##### 5xx : 서버 오류

- 5xx 오류는 서버 오류이므로 클라이언트는 똑같은 요청을 하면 성공할 수도 있음
- 500 Internal Server Error : 서버 문제로 오류 발생
- 503 Service Unavailable : 일시적인 서비스 이용 불가, Retry-After 헤더로 얼마뒤에 복구 되는지 보낼수 있음













#### Reference

모든 개발자를 위한 HTTP 웹 기본 지식\_김영한\_인프런강의

